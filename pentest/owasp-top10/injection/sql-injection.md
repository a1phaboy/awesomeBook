---
description: SQL注入
---

# SQL Injection

危害：数据库信息泄露、数据库被窃取、网页篡改、RCE

分为：数字型注入 和 字符串型注入

条件：输入可控 && 直接/间接拼入SQL语句

执行函数：

java.sql.Statement 原生

java.sql.PreparedStatement 占位符预编译

mybatis: 通过xml映射文件映射sql的标识字符串 #{}为安全写法



### sinks

**直接拼接**

```java
String sql = "select * from users where username = '" + username + "'";
ResultSet rs = statement.executeQuery(sql);
```

**错误的预编译**

```java
String sql = "SELECT * FROM user where id = ?";
sql += " and username like '%" + username +"%'";
```

**order by 注入 order by后面是加字段名而不是引号，因此不能用预编译**

```java
String sql = "Select * from news where title =?" + "order by '" + time + "' asc";
```

**mybatis中几种不能预编译的场景：order by、like、in**

删除语句中可能会存在此类语句,由于无法确定delIds含有对象个数而直接拼接sql语句，造成sql注入。

```java
String sql = "delete from users where id in("+delIds+"); //存在sql注入
```

使用like语句直接拼接会造成sql注入

```java
String sql = "select * from users where password like '%" + con + "%'"; //存在sql注入
```

### keywords

statement、createStatement、PrepareStatement、select、update、insert、like、in、order by



二次注入

二次注入是指对已存的数据库内容被读取后再次进入查询语句之后产生的恶意SQL语句称之为二次注入
